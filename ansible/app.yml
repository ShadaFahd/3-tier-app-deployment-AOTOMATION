---
# ✅ 1. تأكد أن Docker مثبت على جميع الـ VMs
- hosts: all
  become: true
  roles:
    - role: docker_installation

# ✅ 2. شغّل SonarQube على الـ backend_vm_1 فقط
- hosts: sonarqube
  become: true
  roles:
    - role: sonarqube

# ✅ 3. نظف الشبكة والحاويات والملفات المؤقتة
- hosts: all
  become: true
  roles:
    - role: cleanup
      vars:
        docker_containers:
          - frontend
          - backend
        docker_images:
          - frontend
          - backend
        folders_to_delete:
          - /tmp/frontend
          - /tmp/backend
        docker_network_name: app_net

# ✅ 4. أنشئ شبكة Docker
- hosts: all
  become: true
  roles:
    - role: docker_network
      vars:
        docker_network_name: app_net

# ✅ 5. نشر تطبيق الواجهة frontend
- hosts: frontend
  become: true
  roles:
    - role: application
      vars:
        app_name: frontend
        app_image: frontend
        app_container: frontend
        app_src_dir: ../frontend
        app_dest_dir: /tmp/frontend
        exposed_port: 80
        container_port: 3000
        docker_network_name: app_net
        db_connection_string: ""

# ✅ 6. نشر تطبيق backend
- hosts: backend
  become: true
  roles:
    - role: application
      vars:
        app_name: backend
        app_image: backend
        app_container: backend
        app_src_dir: ../backend
        app_dest_dir: /tmp/backend
        exposed_port: 3000
        container_port: 3000
        docker_network_name: app_net
        db_connection_string: "Server=<SQL_SERVER>;Database=<DB_NAME>;User Id=<USER>;Password=<PASSWORD>;"
